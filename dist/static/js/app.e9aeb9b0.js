(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app"],{0:function(e,t,n){e.exports=n("56d7")},"259b":function(e,t){e.exports={title:"校园论坛",baseUrl:"http://localhost:9018",baseApi:"/",APPID:"xxx",APPSECRET:"xxx",$cdn:"https://www.sunniejs.cn/static"}},"56d7":function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"reqUserLogin",(function(){return D})),n.d(a,"reqUserInfo",(function(){return j})),n.d(a,"reqUserReplyCount",(function(){return O})),n.d(a,"changeAvatar",(function(){return $})),n.d(a,"reqEditInfo",(function(){return C})),n.d(a,"reqvalidator",(function(){return q})),n.d(a,"reqUserRegister",(function(){return U}));var r={};n.r(r),n.d(r,"formatDate",(function(){return Pe})),n.d(r,"hidePhone",(function(){return Re}));var i={};n.r(i),n.d(i,"reqSectionList",(function(){return We})),n.d(i,"reqTopicList",(function(){return Ye})),n.d(i,"reqImgList",(function(){return Ge})),n.d(i,"uploadPictures",(function(){return Qe})),n.d(i,"reqPostTopic",(function(){return Ve})),n.d(i,"reqAnnouncement",(function(){return Xe})),n.d(i,"reqReplyList",(function(){return Ze})),n.d(i,"reqSendReply",(function(){return et})),n.d(i,"reqLikeTopic",(function(){return tt})),n.d(i,"reqLikeReply",(function(){return nt})),n.d(i,"reqDeleteTopic",(function(){return at}));n("b0c0"),n("e623"),n("e379"),n("5dc8"),n("37e1"),n("2d26"),n("96cf");var o=n("2b0e"),u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("transition",{attrs:{name:"fade"}},[n("keep-alive",[e.$route.meta.keepAlive?n("router-view"):e._e()],1)],1),n("transition",{attrs:{name:"fade"}},[e.$route.meta.keepAlive?e._e():n("router-view")],1)],1)},c=[],s={name:"App"},p=s,l=(n("f4c2"),n("2877")),d=Object(l["a"])(p,u,c,!1,null,"a0652d8c",null),f=d.exports,h=(n("9a83"),n("f564")),m=n("c964"),v=n("8c4f"),b=(n("d3b7"),[{path:"/",component:function(){return n.e("chunk-1d235c26").then(n.bind(null,"7431"))},redirect:"/home",meta:{title:"首页",keepAlive:!1,index:0},children:[{path:"/home",name:"Home",component:function(){return n.e("chunk-4eb08643").then(n.bind(null,"7abe"))},meta:{title:"首页",keepAlive:!0,index:0}},{path:"/about",name:"About",component:function(){return n.e("chunk-ae321720").then(n.bind(null,"b7b2"))},meta:{title:"我的",keepAlive:!0,index:0}}]},{path:"/search",name:"Search",component:function(){return n.e("chunk-69b4e8ea").then(n.bind(null,"e943"))},meta:{title:"搜索页",keepAlive:!1,index:1}},{path:"/edittopic",name:"EditTopic",component:function(){return n.e("chunk-2d0c02f0").then(n.bind(null,"4163"))},meta:{title:"发帖",keepAlive:!1,index:1}},{path:"/topicdetail",name:"TopicDetail",component:function(){return n.e("chunk-4a6fda72").then(n.bind(null,"eb86"))},meta:{title:"帖子详情",keepAlive:!1,index:1}},{path:"/announcement",name:"Announcement",component:function(){return n.e("chunk-645bd5f3").then(n.bind(null,"69d3"))},meta:{title:"公告详情",keepAlive:!0,index:1}},{path:"/homepage",name:"HomePage",component:function(){return n.e("chunk-01b75280").then(n.bind(null,"ecb7"))},meta:{title:"个人主页",keepAlive:!1,index:1}},{path:"/setting",name:"Setting",component:function(){return n.e("chunk-2d212fc7").then(n.bind(null,"ab6f"))},meta:{title:"设置",keepAlive:!1,index:1}},{path:"/editinfo",name:"EditInfo",component:function(){return Promise.all([n.e("chunk-4605a17a"),n.e("chunk-d6bf49bc")]).then(n.bind(null,"d50e"))},meta:{title:"编辑资料",keepAlive:!1,index:2}},{path:"/tablist",name:"TabList",component:function(){return n.e("chunk-2d21608f").then(n.bind(null,"c16a"))},meta:{title:"帖子列表",keepAlive:!1,index:1}},{path:"/login",name:"Login",component:function(){return n.e("chunk-ac180dbc").then(n.bind(null,"bf25"))},meta:{title:"登录",keepAlive:!1,index:1}},{path:"/register",name:"Register",component:function(){return n.e("chunk-27dc68be").then(n.bind(null,"b381"))},meta:{title:"注册",keepAlive:!1,index:1}}]),g="bbs";function k(){return localStorage.getItem(g)}function x(e){return localStorage.setItem(g,e)}function w(){return localStorage.removeItem(g)}var T=n("2f62"),E={userInfo:function(e){return e.user.userInfo},token:function(e){return e.user.token}},A=E,y=(n("498a"),n("e7e5"),n("d399")),I=n("bc3a"),_=n.n(I),P=n("f121"),L=_.a.create({baseURL:P["baseApi"],withCredentials:!0,timeout:5e3});L.interceptors.request.use((function(e){return K.getters.token&&(e.headers["Authorization"]="Bearer ".concat(k())),e}),(function(e){return Promise.reject(e)})),L.interceptors.response.use((function(e){y["a"].clear();var t=e.data;return t.status&&200!==t.status?(50014===t.status&&K.dispatch("/user/logout").then((function(){location.reload()})),Promise.reject(t||"error")):Promise.resolve(t)}),(function(e){return y["a"].clear(),Promise.reject(e)}));var R=L,S="http://47.100.242.112",D=function(e){return R({url:S+"/app/user/login",method:"post",data:e})},j=function(){return R({url:S+"/app/user/userInfo",method:"get"})},O=function(e){return R({url:S+"/app/user/replyCount",method:"get",params:e})},$=function(e){return R({url:S+"/app/upload/avatar",method:"post",data:e})},C=function(e){return R({url:S+"/app/user/editUserInfo",method:"put",data:e})},q=function(e){return R({url:S+"/app/user/validatorUsername",method:"get",params:e})},U=function(e){return R({url:S+"/app/user/register",method:"post",data:e})},N=function(){return{token:k(),userInfo:{}}},M=N(),z={RESET_STATE:function(e){Object.assign(e,N())},SET_TOKEN:function(e,t){e.token=t},SET_INFO:function(e,t){delete t.iat,delete t.exp,e.userInfo=t}},F={login:function(e,t){var n=e.commit,a=t.username,r=t.password;return new Promise((function(e,t){D({username:a.trim(),password:r}).then((function(t){if(200!==t.code)throw new Error(t.message);var a=t.data;n("SET_TOKEN",a.token),x(a.token),e()})).catch((function(e){t(e)}))}))},getInfo:function(e){var t=e.commit,n=e.state;return new Promise((function(e,a){j(n.token).then((function(n){var r=n.data;if(!r)return w(),a("登录验证失败，请重新登录");t("SET_INFO",r[0]),e(r)})).catch((function(e){a(e)}))}))},logout:function(e){var t=e.commit;e.state;w(),t("RESET_STATE")},register:function(e,t){var n=e.commit,a=t.username,r=t.password;return new Promise((function(e,t){U({username:a.trim(),password:r}).then((function(t){if(200!==t.code)throw new Error(t.message);var a=t.data;n("SET_TOKEN",a.token),x(a.token),e()})).catch((function(e){t(e)}))}))}},B={namespaced:!0,state:M,mutations:z,actions:F};o["a"].use(T["a"]);var H=new T["a"].Store({modules:{user:B},getters:A}),K=H,J=v["a"].prototype.push;v["a"].prototype.push=function(e,t,n){return t||n?J.call(this,e,t,n):J.call(this,e).catch((function(e){return e}))},o["a"].use(v["a"]);var W=function(){return new v["a"]({routes:b})},Y=W();Y.beforeEach(function(){var e=Object(m["a"])(regeneratorRuntime.mark((function e(t,n,a){var r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=k(),!r){e.next=25;break}if("/login"!==t.path){e.next=6;break}a({path:"/"}),e.next=23;break;case 6:if(i=K.getters.userInfo.userName,!i){e.next=11;break}a(),e.next=23;break;case 11:return e.prev=11,e.next=14,K.dispatch("user/getInfo");case 14:a(),e.next=23;break;case 17:return e.prev=17,e.t0=e["catch"](11),e.next=21,K.dispatch("user/logout");case 21:Object(h["a"])({type:"danger",message:e.t0||"请重新登录"}),a("/login?redirect=".concat(t.path));case 23:e.next=26;break;case 25:"/home"==t.path||"/search"==t.path||"/topicdetail"==t.path||"/announcement"==t.path||"/register"==t.path||"/login"==t.path||"/editinfo"==t.path?a():a("/login?redirect=".concat(t.path));case 26:case"end":return e.stop()}}),e,null,[[11,17]])})));return function(t,n,a){return e.apply(this,arguments)}}());var G=Y,Q=(n("91d5"),n("f0ca")),V=(n("4ddd"),n("9f14")),X=(n("a44c"),n("e27c")),Z=(n("d1cf"),n("ee83")),ee=(n("4662"),n("28a2")),te=(n("2cbd"),n("ab2c")),ne=(n("0ec5"),n("21ab")),ae=(n("3df5"),n("2830")),re=(n("8a58"),n("e41f")),ie=(n("5f5f"),n("f253")),oe=(n("e930"),n("8f80")),ue=(n("be7f"),n("565f")),ce=(n("38d5"),n("772a")),se=(n("5246"),n("6b41")),pe=(n("e17f"),n("2241")),le=(n("5f1a"),n("a3e2")),de=(n("480b"),n("a37c")),fe=(n("d82d"),n("7278")),he=(n("c3a6"),n("ad06")),me=(n("66cf"),n("343b")),ve=(n("4056"),n("44bf")),be=(n("0653"),n("34e9")),ge=(n("ab71"),n("58e6")),ke=(n("0cc8"),n("3104")),xe=(n("5852"),n("d961")),we=(n("bda7"),n("5e46")),Te=(n("da3c"),n("0b33")),Ee=(n("537a"),n("ac28")),Ae=(n("a52c"),n("2ed4")),ye=(n("2994"),n("2bdd")),Ie=(n("c194"),n("7744")),_e=(n("66b9"),n("b650"));o["a"].use(_e["a"]),o["a"].use(Ie["a"]),o["a"].use(ye["a"]),o["a"].use(Ee["a"]).use(Ae["a"]),o["a"].use(Te["a"]),o["a"].use(we["a"]),o["a"].use(xe["a"]),o["a"].use(ke["a"]),o["a"].use(ge["a"]),o["a"].use(be["a"]),o["a"].use(ve["a"]),o["a"].use(me["a"]),o["a"].use(he["a"]),o["a"].use(fe["a"]),o["a"].use(de["a"]),o["a"].use(le["a"]),o["a"].use(pe["a"]),o["a"].use(se["a"]),o["a"].use(ce["a"]),o["a"].use(ue["a"]),o["a"].use(oe["a"]),o["a"].use(ie["a"]),o["a"].use(re["a"]),o["a"].use(ae["a"]),o["a"].use(ne["a"]),o["a"].use(te["a"]),o["a"].use(ee["a"]),o["a"].use(Z["a"]),o["a"].use(y["a"]),o["a"].use(h["a"]),o["a"].use(X["a"]),o["a"].use(V["a"]),o["a"].use(Q["a"]);n("9536"),n("a342"),n("499a"),n("4de4"),n("4160"),n("b64b"),n("159b"),n("4d63"),n("ac1f"),n("25f0"),n("5319");function Pe(e,t){if(void 0!==e){var n=new Date(e);/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length)));var a={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds()};for(var r in a)if(new RegExp("(".concat(r,")")).test(t)){var i=a[r]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?i:Le(i))}return t}}function Le(e){return("00"+e).substr(e.length)}function Re(e){return e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2")}Object.keys(r).forEach((function(e){return o["a"].filter(e,r[e])})),o["a"].prototype.$formatDate=o["a"].filter("formatDate"),o["a"].prototype.$hidePhone=o["a"].filter("hidePhone");var Se=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("van-cell-group",{staticStyle:{"margin-bottom":"10px"},attrs:{inset:""},on:{click:e.toDetail}},[n("van-cell",[[n("div",{staticStyle:{overflow:"hidden"}},[n("span",{staticClass:"info"},[n("van-image",{attrs:{round:"","lazy-load":"",width:"50px",height:"50px",src:e.topic.user.userAvatarUrl}})],1),n("span",{staticClass:"info"},[n("div",{staticClass:"nickname"},[e._v(e._s(e.topic.user.userNickname))]),n("div",{staticClass:"time"},[e._v(e._s(this.time))])])]),n("div",[n("h3",{staticClass:"title"},[e._v(e._s(e.topic.tTitle))]),n("p",{staticClass:"content"},[e._v(e._s(e.topic.tContents))]),n("van-image",{attrs:{radius:"5px","lazy-load":"",width:"100%",src:e.topic.tCoverURL}})],1),n("div",{staticClass:"cellfooter"},[n("span",[n("van-icon",{attrs:{name:"chat-o",size:"16"}}),n("em",[e._v(e._s(0==e.topic.tReplyCount?"":e.topic.tReplyCount))])],1),n("span",[n("van-icon",{attrs:{name:"good-job-o",size:"16"}}),n("em",[e._v(e._s(0==e.topic.tLike?"":e.topic.tLike))])],1)])]],2)],1)},De=[],je=n("ed08"),Oe={name:"TopicCell",props:["topic"],computed:{time:function(){return Object(je["a"])(this.topic.tTime)}},methods:{toDetail:function(){this.topic.time=this.time,this.$router.push({name:"TopicDetail",params:this.topic})}}},$e=Oe,Ce=(n("b714"),Object(l["a"])($e,Se,De,!1,null,"f149e8ec",null)),qe=Ce.exports,Ue=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("van-tabs",{staticStyle:{height:"80vh"},attrs:{color:"#7558fe",sticky:"","offset-top":44},model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},[n("van-tab",{attrs:{title:"我的帖子"}},[n("van-list",{staticStyle:{height:"400px","margin-top":"10px"},attrs:{finished:e.finished,"finished-text":"没有更多了","error-text":"请求失败，点击重新加载"},on:{load:function(t){return e.onLoad(e.userInfo.uID)}},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},e._l(e.list,(function(e){return n("TopicCell",{key:e.tID,attrs:{topic:e}})})),1)],1),n("van-tab",{attrs:{title:"",disabled:""}}),n("van-tab",{attrs:{title:"",disabled:""}}),n("van-tab",{attrs:{title:"",disabled:""}})],1)],1)},Ne=[],Me=n("d0ff"),ze=n("f3f3"),Fe={name:"TopicList",data:function(){return{list:[],error:!1,loading:!1,finished:!1,page:1,limit:5,total:0,active:0}},mounted:function(){this.onLoad(this.userInfo.uID)},computed:Object(ze["a"])({},Object(T["b"])(["userInfo"])),methods:{getList:function(e){var t=this;return Object(m["a"])(regeneratorRuntime.mark((function n(){var a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$API.home.reqTopicList({page:t.page,limit:t.limit,sID:"",uID:e});case 2:r=n.sent,t.refreshing=!1,0===r.data.length&&(t.list=[],t.finished=!0),t.total=r.data.count,(a=t.list).push.apply(a,Object(Me["a"])(r.data.rows)),t.loading=!1,t.list.length>=r.data.count&&(t.finished=!0);case 9:case"end":return n.stop()}}),n)})))()},onLoad:function(e){this.getList(e),this.page++}}},Be=Fe,He=Object(l["a"])(Be,Ue,Ne,!1,null,"0ee40129",null),Ke=He.exports,Je="http://47.100.242.112",We=function(){return R({url:Je+"/app/home/sectionList",method:"get"})},Ye=function(e){return R({url:Je+"/app/home/topicList",method:"get",params:e})},Ge=function(e){return R({url:Je+"/app/home/imgList",method:"get",params:e})},Qe=function(e){return R({url:Je+"/app/upload/pictures",method:"post",data:e})},Ve=function(e){return R({url:Je+"/app/home/postTopic",method:"post",data:e})},Xe=function(){return R({url:Je+"/app/home/announcement",method:"get"})},Ze=function(e){return R({url:Je+"/app/home/replyList",method:"get",params:e})},et=function(e){return R({url:Je+"/app/home/sendReply",method:"post",data:e})},tt=function(e){return R({url:Je+"/app/home/likeTopic",method:"post",data:e})},nt=function(e){return R({url:Je+"/app/home/likeReply",method:"post",data:e})},at=function(e){return R({url:Je+"/app/home/deleteTopic",method:"delete",data:e})},rt={user:a,home:i};o["a"].prototype.$cdn=P["$cdn"],o["a"].component(qe.name,qe),o["a"].component(Ke.name,Ke),o["a"].config.productionTip=!1,o["a"].prototype.$API=rt,new o["a"]({el:"#app",router:G,store:K,render:function(e){return e(f)}}),document.addEventListener("plusready",(function(){var e=null,t=window.plus.webview.currentWebview();window.plus.key.addEventListener("backbutton",(function(){t.canBack((function(n){n.canBack?t.back():e?(new Date).getTime()-e<1e3&&window.plus.runtime.quit():(e=(new Date).getTime(),window.plus.nativeUI.toast("再按一次退出应用",{duration:"short"}),setTimeout((function(){e=null}),1e3))}))}))}))},"57d7":function(e,t,n){},"66ec":function(e,t,n){},7609:function(e,t,n){var a={"./env.development":"259b","./env.development.js":"259b","./env.production":"f1e0","./env.production.js":"f1e0","./env.staging":"e101","./env.staging.js":"e101"};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=i,e.exports=r,r.id="7609"},9536:function(e,t,n){},a342:function(e,t,n){},b714:function(e,t,n){"use strict";var a=n("66ec"),r=n.n(a);r.a},e101:function(e,t){e.exports={title:"vue-h5-template",baseUrl:"https://test.xxx.com",baseApi:"https://test.xxx.com/api",APPID:"xxx",APPSECRET:"xxx",$cdn:"https://www.sunniejs.cn/static"}},ed08:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n("d3b7"),n("ac1f"),n("25f0"),n("5319"),n("1276"),n("0122");function a(e){var t=new Date(e).getTime(),n=Date.now(),a=(n-t)/1e3,r=e.split(" ")[0].split("-");return r=r[1]+"月"+r[2]+"日",a<30?"刚刚":a<3600?Math.ceil(a/60)+"分钟前":a<86400?Math.ceil(a/3600)+"小时前":a<172800?"1天前":r}},f121:function(e,t,n){var a="production",r=n("7609")("./env."+a);e.exports=r},f1e0:function(e,t){e.exports={title:"校园论坛",baseUrl:"http://localhost:9018",baseApi:"/",APPID:"xxx",APPSECRET:"xxx",$cdn:"https://www.sunniejs.cn/static"}},f4c2:function(e,t,n){"use strict";var a=n("57d7"),r=n.n(a);r.a}},[[0,"runtime","chunk-vantUI","chunk-libs"]]]);