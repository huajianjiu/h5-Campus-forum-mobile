(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c02f0"],{4163:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("van-nav-bar",{attrs:{fixed:"",placeholder:"",title:"编辑帖子","left-arrow":""},on:{"click-left":t.onClickLeft}}),n("van-cell",{staticStyle:{margin:"5px 0 0 0","padding-bottom":"50px"}},[[n("van-form",{on:{submit:t.onSubmit}},[n("van-field",{attrs:{name:"tTitle",placeholder:"请输入完整帖子标题（5-31个字）",rules:[{required:!0,message:"请输入标题"},{validator:t.validator,message:"字数必须在5-31"}]},model:{value:t.topicForm.tTitle,callback:function(e){t.$set(t.topicForm,"tTitle",e)},expression:"topicForm.tTitle"}}),n("van-field",{attrs:{name:"tContents",rows:"5",autosize:"",type:"textarea",maxlength:"500",placeholder:"来吧，尽情发挥吧...","show-word-limit":""},model:{value:t.topicForm.tContents,callback:function(e){t.$set(t.topicForm,"tContents",e)},expression:"topicForm.tContents"}}),n("van-field",{attrs:{name:"uploader",placeholder:"最多选择6张"},scopedSlots:t._u([{key:"input",fn:function(){return[n("van-uploader",{attrs:{"max-count":6,multiple:"","before-read":t.beforeRead,"after-read":t.afterRead,"before-delete":t.delUploadImg,"upload-icon":"plus"},model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}})]},proxy:!0}])}),n("van-field",{attrs:{readonly:"",clickable:"",label:"所属板块",colon:"",name:"picker",placeholder:"点击选择板块",rules:[{required:!0,message:"请选择板块"}]},on:{click:function(e){t.showPicker=!0}},model:{value:t.section,callback:function(e){t.section=e},expression:"section"}}),n("van-popup",{attrs:{position:"bottom"},model:{value:t.showPicker,callback:function(e){t.showPicker=e},expression:"showPicker"}},[n("van-picker",{attrs:{"show-toolbar":"",columns:t.columns},on:{confirm:t.onConfirm,cancel:function(e){t.showPicker=!1}}})],1),n("div",{staticStyle:{margin:"20px"}},[n("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit"}},[t._v("发布")])],1)],1)]],2)],1)},o=[],a=(n("4de4"),n("4160"),n("caad6"),n("a15b"),n("baa5"),n("d81d"),n("b0c0"),n("159b"),n("96cf"),n("c964")),r=n("f3f3"),s=n("2f62"),c={name:"editTpic",data:function(){return{fileList:[],section:"",showPicker:!1,sectionList:[],topicForm:{userUID:"",tTitle:"",tContents:"",tCoverURL:"",sectionSID:""},imgList:[]}},mounted:function(){this.sectionList=this.$route.params.sectionList,this.topicForm.userUID=this.userInfo.uID},computed:Object(r["a"])(Object(r["a"])({},Object(s["b"])(["userInfo"])),{},{columns:function(){return this.sectionList.map((function(t){return t.sName}))}}),methods:{validator:function(t){return t.length>=5&&t.length<=31},onClickLeft:function(){this.$router.go(-1)},onSubmit:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var n,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.imgList.length>0&&(t.topicForm.tCoverURL=t.imgList[0]),n=t.topicForm,i=t.imgList,e.next=4,t.$API.home.reqPostTopic({topicForm:n,imgList:i});case 4:o=e.sent,200==o.code?(t.$toast.success("发送成功"),t.$router.go(-1)):t.$toast.fail("发送失败，请重启软件");case 6:case"end":return e.stop()}}),e)})))()},onConfirm:function(t){this.section=t;for(var e=JSON.parse(JSON.stringify(this.sectionList)),n=0;n<e.length;n++)if(e[n].sName==t){this.topicForm.sectionSID=e[n].sID;break}this.showPicker=!1},beforeRead:function(t){var e=this;if(!(t instanceof Array))return this.checkFile(t);if(t.length>6)return this.$toast.fail("最多上传6张图片"),!1;var n=0;return t.forEach((function(t){e.checkFile(t)||n++})),0==n},checkFile:function(t){var e=["jpg","png","jpeg"],n=t.name.lastIndexOf("."),i=t.name.substr(n+1);return!!e.includes(i.toLowerCase())||(this.$toast("请上传"+e.join(",")+"格式图片"),!1)},afterRead:function(t){var e=this;t instanceof Array?t.map((function(t){t.status="uploading",t.message="上传中...",e.uploadImg(t)})):(t.status="uploading",t.message="上传中...",this.uploadImg(t))},uploadImg:function(t){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var i,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=new FormData,i.append("pictures",t.file),n.prev=2,n.next=5,e.$API.home.uploadPictures(i);case 5:o=n.sent,200===o.code&&o.data&&(t instanceof Array?t.map((function(t,e){t.status="success",t.message="",t.url=o.data[e]})):(e.imgList.push(o.data[0]),t.status="success",t.message="",t.url=o.data[0])),n.next=12;break;case 9:n.prev=9,n.t0=n["catch"](2),e.$notify({type:"warning",message:"上传失败"});case 12:case"end":return n.stop()}}),n,null,[[2,9]])})))()},delUploadImg:function(t){this.fileList=this.fileList.filter((function(e){return e.url!=t.url}))}}},l=c,u=n("2877"),f=Object(u["a"])(l,i,o,!1,null,"8e4a066e",null);e["default"]=f.exports}}]);