(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d6bf49bc"],{1106:function(e,t,r){},"568e":function(e,t,r){},"829b":function(e,t,r){"use strict";var o=r("1106"),n=r.n(o);n.a},d50e:function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"height100"},[r("van-nav-bar",{attrs:{fixed:"",placeholder:"",title:"编辑资料","left-arrow":e.showLeft,"right-text":"保存"},on:{"click-left":e.onClickLeft,"click-right":e.onClickRight}}),r("div",{staticClass:"avatarsection"},[r("div",{staticClass:"outer"},[r("div",{staticClass:"innerbox"},[r("van-image",{attrs:{round:"",width:"60px",height:"60px",src:e.userForm.userAvatarUrl}})],1),r("div",{staticClass:"zhezhao"},[r("van-uploader",{attrs:{"max-size":3145728,"before-read":e.beforeRead},on:{oversize:e.onOversize}},[r("span",{staticClass:"iconfont",staticStyle:{"font-size":"20px",display:"inline-block",width:"60px",height:"60px"}},[e._v("")])])],1)]),r("div",{staticStyle:{"text-align":"center","font-size":"14px","padding-top":"10px"}},[e._v("点击更换头像")])]),r("van-cell-group",[r("van-cell",{attrs:{"is-link":"",title:"昵称"},on:{click:function(t){return e.showTextarea(1)}},model:{value:e.userForm.userNickname,callback:function(t){e.$set(e.userForm,"userNickname",t)},expression:"userForm.userNickname"}}),r("van-cell",{attrs:{title:"性别"}},[r("van-radio-group",{staticStyle:{float:"right"},attrs:{"checked-color":"#7558fe",direction:"horizontal"},model:{value:e.userForm.userGender,callback:function(t){e.$set(e.userForm,"userGender",t)},expression:"userForm.userGender"}},[r("van-radio",{attrs:{name:"男"}},[e._v("男")]),r("van-radio",{attrs:{name:"女"}},[e._v("女")])],1)],1),r("van-cell",{attrs:{"is-link":"",title:"生日"},on:{click:e.showPopup},model:{value:e.userForm.userBirthday,callback:function(t){e.$set(e.userForm,"userBirthday",t)},expression:"userForm.userBirthday"}}),r("van-popup",{attrs:{position:"bottom",round:""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[r("van-datetime-picker",{attrs:{type:"date",title:"选择年月日","min-date":e.minDate,"max-date":e.maxDate},on:{cancel:function(t){e.show=!1},confirm:e.getBirthday},model:{value:e.currentDate,callback:function(t){e.currentDate=t},expression:"currentDate"}})],1),r("van-cell",{attrs:{"is-link":"",title:"简介"},on:{click:function(t){return e.showTextarea(2)}},model:{value:e.userForm.userStatement,callback:function(t){e.$set(e.userForm,"userStatement",t)},expression:"userForm.userStatement"}})],1),r("van-field",{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}],staticStyle:{position:"fixed","z-index":"1000",bottom:"0"},attrs:{id:"edit",rows:"2",autosize:"",type:"textarea",maxlength:e.maxlength,placeholder:"请输入要修改的内容","show-word-limit":""},on:{blur:e.fieldEvent},scopedSlots:e._u([{key:"button",fn:function(){return[r("van-button",{attrs:{size:"small",type:"primary"}},[e._v("完成")])]},proxy:!0}]),model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}),r("van-popup",{staticClass:"bg-tran",style:{height:"100%"},attrs:{closeable:"",position:"top"},model:{value:e.showCropper,callback:function(t){e.showCropper=t},expression:"showCropper"}},[r("div",{staticClass:"flex-column-center height100"},[r("vueCropper",{ref:"cropper",attrs:{img:e.option.img,outputSize:e.option.outputSize,outputType:e.option.outputType,info:e.option.info,full:e.option.full,autoCropWidth:e.option.autoCropWidth,autoCropHeight:e.option.autoCropHeight,canMove:e.option.canMove,canMoveBox:e.option.canMoveBox,original:e.option.original,autoCrop:e.option.autoCrop,fixed:e.option.fixed,fixedNumber:e.option.fixedNumber,centerBox:e.option.centerBox,infoTrue:e.option.infoTrue,fixedBox:e.option.fixedBox,high:e.option.high,mode:e.option.mode}}),r("div",{staticClass:"popup_bottom"},[r("div",{staticClass:"bottom_item"},[r("span",{on:{click:e.cancelCropper}},[e._v("取消")])]),r("div",{staticClass:"bottom_item"},[r("span",{staticClass:"font18",on:{click:e.rotateImage}},[r("van-icon",{attrs:{name:"replay"}})],1)]),r("div",{staticClass:"bottom_item"},[r("span",{on:{click:e.getCropBlob}},[e._v("确定")])])])],1)])],1)},n=[],a=(r("caad6"),r("b0c0"),r("ac1f"),r("2532"),r("466d"),r("5319"),r("f3f3")),i=(r("96cf"),r("c964")),s=r("5a0c"),u=r.n(s),c=r("2f62"),l=r("7e79"),p={name:"EditInfo",mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.getUserInfo(),e.userForm=Object(a["a"])({},e.userInfo),null==e.userInfo.userNickname&&(e.showLeft=!1);case 3:case"end":return t.stop()}}),t)})))()},data:function(){return{name:"",userForm:{uID:"",userAvatarUrl:"",userBirthday:"",userGender:"",userName:"",userNickname:"",userStatement:null},showCropper:!1,imageAccept:"/jpg,/png,/jpeg",imageFileName:"",option:{img:"",outputSize:.8,info:!1,outputType:"jpeg",canScale:!1,autoCrop:!0,autoCropWidth:window.innerWidth-100+"px",autoCropHeight:window.innerWidth-100+"px",high:!0,fixedBox:!0,fixed:!0,fixedNumber:[1,1],full:!0,canMoveBox:!1,original:!1,centerBox:!1,infoTrue:!1,mode:"100% auto"},isChecked:!0,isChecked1:!1,message:"",isShow:!1,date:"",show:!1,minDate:new Date(1960,0,1),maxDate:new Date,maxlength:"",editting:"",showLeft:!0}},components:{VueCropper:l["VueCropper"]},computed:Object(a["a"])(Object(a["a"])({},Object(c["b"])(["userInfo"])),{},{currentDate:{get:function(){return u()(this.userInfo.userBirthday).$d},set:function(e){u()(this.userInfo.userBirthday).$d=e}}}),beforeRouteEnter:function(e,t,r){r((function(e){e.name=t.name}))},methods:{onClickLeft:function(){this.$router.go(-1)},getUserInfo:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("user/getInfo");case 2:case"end":return t.stop()}}),t)})))()},onOversize:function(){this.$toast("图片不能大于3M")},getFileSuffix:function(e){return e.match(/\/\w+$/)[0].toLowerCase()},beforeRead:function(e){if(!this.imageAccept.includes(this.getFileSuffix(e.type)))return this.$toast("请上传 jpg/png 格式图片");this.showCropper=!0,this.imageFileName=e.name,this.imageToBase64(e)},imageToBase64:function(e){var t=this,r=new FileReader;r.readAsDataURL(e),r.onload=function(){t.option.img=r.result},r.onerror=function(e){}},getCropBlob:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$toast("上传中",0),r=new FormData,e.$refs.cropper.getCropBlob((function(t){r.append("avatar",t,e.imageFileName),e.$API.user.changeAvatar(r).then((function(t){200===t.code?(e.showCropper=!1,e.userForm.userAvatarUrl=t.data.url,e.$toast("更改头像成功")):(e.showCropper=!1,e.$toast("上传失败"))})).catch((function(e){}))}));case 3:case"end":return t.stop()}}),t)})))()},rotateImage:function(){this.$refs.cropper.rotateRight()},cancelCropper:function(){this.showCropper=!1,this.showPopup=!0},showTextarea:function(e){setTimeout((function(){document.getElementById("edit").focus()}),0),this.editting=e,1==e?(this.message=this.userForm.userNickname,this.maxlength=20):(this.message=this.userForm.userStatement,this.maxlength=100),this.isShow=!0},fieldEvent:function(){1==this.editting?this.userForm.userNickname=this.message:this.userForm.userStatement=this.message,this.isShow=!1},showPopup:function(){this.show=!0},getBirthday:function(e){this.userForm.userBirthday=u()(e).locale("zh-cn").format("YYYY-MM-DD"),this.show=!1},onClickRight:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!=e.userForm.userAvatarUrl&&""!=e.userForm.userAvatarUrl){t.next=5;break}return e.$toast("请上传头像"),t.abrupt("return");case 5:if(null!=e.userForm.userNickname&&""!=e.userForm.userNickname){t.next=10;break}return e.$toast("昵称不能为空"),t.abrupt("return");case 10:if(null!=e.userForm.userGender&&""!=e.userForm.userGender){t.next=15;break}return e.$toast("请选择性别"),t.abrupt("return");case 15:if(null!=e.userForm.userBirthday&&""!=e.userForm.userBirthday){t.next=20;break}return e.$toast("请选择生日"),t.abrupt("return");case 20:return t.next=22,e.$API.user.reqEditInfo(e.userForm);case 22:r=t.sent,200==r.code&&(e.$toast.success("编辑成功"),e.getUserInfo(),"Register"==e.name?e.$router.replace({path:e.$route.query.redirect||"/"}):e.$router.go(-1));case 24:case"end":return t.stop()}}),t)})))()}}},m=p,h=(r("829b"),r("f82a"),r("2877")),f=Object(h["a"])(m,o,n,!1,null,"7e0a84bc",null);t["default"]=f.exports},f82a:function(e,t,r){"use strict";var o=r("568e"),n=r.n(o);n.a}}]);